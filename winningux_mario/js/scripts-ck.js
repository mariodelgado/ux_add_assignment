//Sticky header. Too wonky.
// TODO: find a jQuery plugin
function stickHeader(){var e=$("bb_chrome_header"),t=$("bb_chrome"),n=e.offsetHeight,r=$("bb_content_holder"),i=$("bb_payload").offsetHeight,s=e.style.position=="fixed";if(!s&&e.viewportOffset().top<0){origHeaderPosTop=e.cumulativeOffset().top;e.style.position="fixed";e.style.top="0px";e.addClassName("sticky");r.style.top=n-17+"px";r.style.minHeight=n-17+"px";r.style.minHeight=i+"px";t.style.minHeight=i+n-17+"px"}var o=document.viewport.getScrollOffsets().top;if(s&&o<origHeaderPosTop){e.style.position="relative";e.removeClassName("sticky");r.style.top="auto"}}function adjustH(){var e=$("bb_box"),t=$("bb_chrome_header").offsetHeight,n=$("bb_chrome"),r=window.innerHeight;e.style.minHeight=r+"px";$("bb_payload").style.minHeight=r+"px"}function adjustConvH(){var e=$("conversation_wrapper"),t=$("mybb_header").offsetHeight,n=$("conversation_utility").offsetHeight,r=window.innerHeight;e.style.height=r-t-n+"px"}function togglePageMode(e){if(e.className=="button"){$("bb_payload")&&$("bb_payload").addClassName("is-editable edit-controls-show");$("bb_content_nav")&&$("bb_content_nav").addClassName("is-editable edit-controls-show");$$(".hero-holder")[0]&&$$(".hero-holder")[0].addClassName("is-editable edit-controls-show");setTimeout(function(){$("bb_payload").removeClassName("edit-controls-show").addClassName("edit-controls-hide")},2e3);setTimeout(function(){$("bb_content_nav").removeClassName("edit-controls-show").addClassName("edit-controls-hide")},2e3);setTimeout(function(){$$(".hero-holder")[0].removeClassName("edit-controls-show").addClassName("edit-controls-hide")},2e3);e.down(".text-primary").childNodes[1].nodeValue=" ON";e.down('[class*="icon"]').setAttribute("data-icon","2");e.addClassName("button-success");return!1}if(e.className=="button button-success"){$("bb_payload")&&$("bb_payload").removeClassName("is-editable").removeClassName("edit-controls-hide").removeClassName("edit-controls-show");$("bb_content_nav")&&$("bb_content_nav").removeClassName("is-editable").removeClassName("edit-controls-hide").removeClassName("edit-controls-show");e.removeClassName("button-success");e.down(".text-primary").childNodes[1].nodeValue=" OFF";e.down('[class*="icon"]').setAttribute("data-icon","â—‹");return!1}return!1}function togglePageMode_remote(){$$("status-toggle")[0].addClasseName("on");$$("status-toggle")[0].down(".status-value").innerHTML="ON";$("bb_payload").addClassName("is-editable edit-controls-show");$("bb_content_nav").addClassName("is-editable edit-controls-show");$("bb_payload")&&setTimeout(function(){$("bb_payload").removeClassName("edit-controls-show").addClassName("edit-controls-hide")},2e3);$("bb_content_nav")&&setTimeout(function(){$("bb_content_nav").removeClassName("edit-controls-show").addClassName("edit-controls-hide")},2e3)}function toggleCourseMode(e){if(e.className=="status-toggle"){e.down(".status-value").innerHTML="ON";e.addClassName("on");return!1}if(e.className=="status-toggle on"){e.removeClassName("on");e.down(".status-value").innerHTML="OFF";return!1}return!1}function simpleModeToggle(e){e.className=="status-toggle"?e.addClassName("on"):e.className=="status-toggle on"&&e.removeClassName("on")}function toggleCourseMenu(){$("bb_content_holder").toggleClassName("has-menu")}function togglePathMenu(){$("path_menu").toggle()}function editPage(){var e=$$(".page-wide-editable"),t=$$(".vtbe-output");e.each(function(e){e.insert({top:new Element("input",{type:"text",value:"","class":"edit-mode-input"})})});t.each(function(e){e.hide()});var n=$$(".edit-mode-input"),r=$$("h3 > .edit-mode-input");n.each(function(e){e.value=e.next("span").childNodes[0].nodeValue;e.next("span").hide();$$(".control-bar")[0].hide()});r.each(function(e){e.insert({before:new Element("input",{type:"checkbox","class":"pw-checkbox"})})});$("bb_payload").removeClassName("is-editable").addClassName("pw-edit-mode");$("pw_edit_mode_controls").show();var i=$$(".list-controls");i.each(function(e){e.show()})}function savePage(){var e=$$(".page-wide-editable"),t=$$(".vtbe-output"),n=$$(".edit-mode-input"),r=$$('h3 > input[type="checkbox"]');n.each(function(e){e.next("span").show();e.next("span").childNodes[0].nodeValue=e.value;e.remove();$$(".control-bar")[0].show()});r.each(function(e){e.remove()});t.each(function(e){e.show()});$("bb_payload").addClassName("is-editable").removeClassName("pw-edit-mode");$("pw_edit_mode_controls").hide();var i=$$(".list-controls");i.each(function(e){e.hide()})}function inlineEdit(e){e.up(1).previous(".title-text").insert({before:new Element("input",{type:"text",value:"","class":"edit-mode-input inline-mode"})});e.up(1).insert({after:new Element("a",{href:"#",id:"inline_save",title:"Save changes","class":"button button-clear button-notext element-temp",onclick:"inlineSave(); return false"})});$("inline_save").insert({top:new Element("i",{"data-icon":"3","class":"icon-center"})});e.up(1).insert({after:new Element("a",{href:"#",id:"inline_undo",title:"Undo","class":"button button-clear button-notext element-temp",onclick:"inlineSave(); return false"})});$("inline_undo").insert({top:new Element("i",{"data-icon":"1","class":"icon-center"})});var t=$(".edit-mode-input.inline-mode");e.up(1).previous(".title-text").hide();e.up(1).hide();e.up(1).previous("input").value=e.up(1).previous(".title-text").innerHTML;e.up(1).previous("input").focus();$("bb_payload").removeClassName("is-editable");return!1}function inlineSave(){var e=$$(".edit-mode-input"),t=$$(".element-temp");e.each(function(e){e.next(".control-bar").show();e.next(".title-text").show();e.next().innerHTML=e.value;e.remove()});t.each(function(e){e.remove()});$("bb_payload").addClassName("is-editable")}function showAdd(e){var t=$("just_cloned"),n=$("add_menu").clone(5);if(t){t.blindUp({duration:.1});setTimeout(function(){t.remove()},1e3)}else{$("bb_payload").removeClassName("is-editable");e.up(1).insert({before:n});n.writeAttribute({id:"just_cloned"}).addClassName("display").blindDown({duration:.2})}}function showMenuAdd(e){var t=$("just_cloned"),n=$("add_bb_content_nav").clone(5);if(t){t.blindUp({duration:.1});setTimeout(function(){t.remove()},1e3)}else{$("bb_content_nav")&&$("bb_content_nav").removeClassName("is-editable");e.up(1).insert({before:n});n.writeAttribute({id:"just_cloned"}).addClassName("display").blindDown({duration:.2})}}function showToolsAdd(e){var t=$("just_cloned"),n=$("add_tools").clone(5);if(t){t.blindUp({duration:.1});setTimeout(function(){t.remove()},1e3)}else{$("bb_content_nav")&&$("bb_content_nav").removeClassName("is-editable");e.up(1).insert({before:n});n.writeAttribute({id:"just_cloned"}).addClassName("display").blindDown({duration:.2})}}function showUpload(e){var t=$("current_upload"),n=$("upload_progress").clone(5),r=$("new_item").clone(5);if(t){t.blindUp({duration:.1});setTimeout(function(){t.remove()},1e3)}else{$("bb_payload").removeClassName("is-editable");e.up(1).insert({before:n});n.writeAttribute({id:"current_upload_1"}).addClassName("display").blindDown({duration:.2});setTimeout(function(){$("current_upload_1").hide()},5e3);r.writeAttribute({id:"new_item_1"}).addClassName("new-item").blindDown({duration:.2});setTimeout(function(){$("current_upload_1").insert({after:r})},5e3);r.show();setTimeout(function(){$("bb_payload").addClassName("is-editable")},5e3)}}function addCourseTheme(){var e=$("custom_course_css");e?e.remove():$$("head")[0].insert({bottom:new Element("link",{rel:"stylesheet",href:"../css/course_theme.css",id:"custom_course_css"})})}function showAb(){var e=$("just_cloned"),t=$("create_menu").clone(5);if(e){e.blindUp({duration:.1});setTimeout(function(){e.remove()},500)}else{$("page_header").insert({after:t});t.writeAttribute({id:"just_cloned"}).blindDown({duration:.2})}}function showFullPage(e){var t=$("bb_payload").clone(10),n=$("cloned_content"),r=$("full_page");if(n){n.remove();$("dark_overlay").remove();$$("body")[0].removeClassName("full-view")}else{$$("body")[0].insert({bottom:t});$$("body")[0].addClassName("full-view").insert({bottom:new Element("div",{"class":"dark-overlay",id:"dark_overlay"})});t.writeAttribute({id:"cloned_content"}).addClassName("cloned-content-overlay");$$(".cloned-content-overlay #full_page span")[0].setAttribute("data-icon","*");$$(".cloned-content-overlay #full_page span")[0].setAttribute("title","Exit Full Page View");$$(".bb-payload.cloned-content-overlay .control-bar a:not(.full-page)").each(function(e){e.hide()});$$(".bb-payload.cloned-content-overlay #full_page")[0].show()}}function toggleGlobalNav(e){$("global_nav_flyout").toggleClassName("display");e.up(1).hide();e.up(1).appear({duration:.6})}function createArea(){$("empty_message").hide();$("empty_add").hide();$("fresh_area").show();$("adding_now").focus()}function toggleSpokeContent(e){e.next().toggle()}function detectMobileClient(){window.innerWidth<=800&&window.innerHeight<=600||$$(".course-page")[0]}function showAddSection(e){var t=$("just_cloned"),n=$("add_lesson_section").clone(5);if(t){t.blindUp({duration:.1});setTimeout(function(){t.remove()},1e3)}else{$("bb_payload").removeClassName("is-editable");e.up(1).insert({before:n});n.writeAttribute({id:"just_cloned"}).addClassName("display").blindDown({duration:.2})}}function addSectionElement(e){var t=$("just_cloned"),n=$("section_title_input").value;e.up(1).insert({before:new Element("section",{id:"section_new","class":"lesson-section"})});$("section_new").innerHTML="<h2>"+n+"</h2>";t.remove()}function addStuff(e){var t=$("add_text").clone(5);e.up(1).remove();$("section_new").insert({bottom:t});t.writeAttribute({id:"just_cloned"}).addClassName("display").blindDown({duration:.2})}function addStuff_2(e,t){var n=$(t).clone(5);e.up(1).insert({before:n});e.up(1).remove();n.writeAttribute({id:"just_cloned"}).addClassName("display").blindDown({duration:.2});return!1}var origHeaderPosTop;document.observe("dom:loaded",function(){function e(e){var t=window.onload;typeof window.onload!="function"?window.onload=e:window.onload=function(){t&&t();e()}}function t(e){var t=window.onresize;typeof window.onresize!="function"?window.onresize=e:window.onresize=function(){t&&t();e()}}e(adjustH);e(detectMobileClient);t(adjustH);$("bb_content_nav_toggle")&&$("bb_content_nav_toggle").observe("mouseover",function(){$("bb_content_holder").addClassName("has-menu-peek")});$("bb_content_nav_toggle")&&$("bb_content_nav_toggle").observe("mouseout",function(){$("bb_content_holder").removeClassName("has-menu-peek")});$("bb_content_nav")&&$("bb_content_nav").observe("mouseover",function(){$("bb_content_holder").addClassName("has-menu-peek")});$("bb_content_nav")&&$("bb_content_nav").observe("mouseout",function(){$("bb_content_holder").removeClassName("has-menu-peek")});$("bb_content_nav_toggle")&&$("bb_content_nav_toggle").observe("click",function(){$("bb_content_nav")&&$("bb_content_nav").toggleClassName("display");$$(".bb-payload")[0]&&$$(".bb-payload")[0].up().toggleClassName("has-menu");return!1});$("current_tab")&&$("current_tab").observe("mouseover",function(){$("system_tabs").addClassName("display")});$("system_tabs")&&$("system_tabs").observe("mouseover",function(){$("system_tabs").addClassName("display")});$("current_tab")&&$("current_tab").observe("mouseout",function(){$("system_tabs").removeClassName("display")});$("system_tabs")&&$("system_tabs").observe("mouseout",function(){$("system_tabs").removeClassName("display")});$$(".area-add").each(function(e){e.observe("click",function(){var t=$("just_cloned"),n=$("add_to_area_menu").clone(5);if(t){t.blindUp({duration:.1});setTimeout(function(){t.remove()},1e3)}else{$("bb_payload").removeClassName("is-editable");e.up("div.item-actions").hide();e.up(2).down("h3.content-item-title").insert({before:n});n.writeAttribute({id:"just_cloned"}).addClassName("display").blindDown({duration:.7})}})});$$(".discussions-add").each(function(e){e.observe("click",function(){var t=$("just_cloned"),n=$("add_to_discussions_menu").clone(5);if(t){t.blindUp({duration:.1});setTimeout(function(){t.remove()},1e3)}else{$("bb_payload").removeClassName("is-editable");e.up("div.item-actions").hide();e.up(2).down("h3.content-item-title").insert({before:n});n.writeAttribute({id:"just_cloned"}).addClassName("display").blindDown({duration:.7})}})});$("control_panel_toggle")&&$("control_panel_toggle").observe("click",function(){$("manage_menu_2").addClassName("display");$("control_panel_toggle").hide();return!1});$("close_control_panel")&&$("close_control_panel").observe("click",function(){$("manage_menu_2").removeClassName("display");$("control_panel_toggle").show();return!1});$("close_setup_header")&&$("close_setup_header").observe("click",function(){$("manage_menu_2").addClassName("display");$("setup_header").fade({duration:.25});$("control_panel_toggle").hide();$("welcomeOverlay").style.top="100%";$("cm_help").appear({duration:.5});setTimeout(function(){$("cm_help").fade({duration:.2})},6e3);return!1});$("cr")&&$("cr").observe("click",function(){$$(".cr").each(function(e){e.toggle()})});$("goals")&&$("goals").observe("click",function(){$$(".goal").each(function(e){e.toggle()})});$("programs")&&$("programs").observe("click",function(){$$(".headcount").each(function(e){e.toggle()})});$$(".batch-selector")[0]&&$$(".batch-selector").each(function(e){e.observe("click",function(){$$(".batch-control").each(function(e){e.toggle("appear",{duration:.3})});$$('input[type="checkbox"]').each(function(e){var t=!1;if(e.checked===!1){e.setAttribute("checked",!0);t="true"}else{e.writeAttribute("checked",!1);t="false"}})})});$("course_settings_edit")&&$("course_settings_edit").observe("click",function(){$$(".readable").each(function(e){e.toggle()});$$(".editable").each(function(e){e.toggle()});$$(".input-title")[0].toggleClassName("disabled");$$(".editable-block")[0].toggleClassName("on");$("course_settings_edit").hide()});$$(".inline-control")[0]&&$$(".inline-control").each(function(e){e.observe("click",function(){$$(".readable").each(function(e){e.toggle()});$$(".editable").each(function(e){e.toggle()});$$(".input-title")[0].toggleClassName("disabled");$$(".editable-block")[0].toggleClassName("on");$("course_settings_edit").show()})});$$(".msg-filter.bio")[0]&&$$(".msg-filter.bio")[0].observe("click",function(){$$(".message.soc").each(function(e){e.blindUp({duration:.2})});$$(".message.psy").each(function(e){e.blindUp({duration:.2})});$$(".message.peer").each(function(e){e.blindUp({duration:.2})});$("pulldown_link").innerHTML=$$(".msg-filter.bio")[0].innerHTML});$$(".msg-filter.all")[0]&&$$(".msg-filter.all")[0].observe("click",function(){$$(".message").each(function(e){e.show()});$("pulldown_link").innerHTML=$$(".msg-filter.all")[0].innerHTML});$("compose_btn")&&$("compose_btn").observe("click",function(){$("compose_msg").show();$$("body")[0].insert({bottom:new Element("div",{"class":"compose-overlay",id:"compose_overlay"})})});$$(".close-lb")&&$$(".close-lb").each(function(e){e.observe("click",function(){$("compose_msg").hide();$("compose_overlay").remove()})})});